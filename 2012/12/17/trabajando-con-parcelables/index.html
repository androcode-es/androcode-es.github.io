<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <meta name="theme-color" content="#558B2F">

  <title>
    
      Trabajando con Parcelables &middot; Androcode
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface|Roboto+Condensed:bold">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-androcode">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          <img class="sidebar-logo" src="/public/logo_white_100w.png" />
          Androcode
        </a>
      </h1>
      <p class="lead">Androcode es programación, Androcode es tecnología, Androcode necesita una descripción nueva.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Inicio</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">¿Quiénes somos?</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/androteca/">La Androteca</a>
          
        
      
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <nav class="sidebar-social">
      <ul class="navigation">

        <li class="social-item twitter">
          <a href="http://twitter.com/@androcode" title="@androcode on Twitter" target="_blank">
            <i class="icon fa fa-twitter"></i>
            <span class="label">Twitter</span>
          </a>
        </li>

        <li class="social-item gplus">
          <a href="https://plus.google.com/+AndrocodeEs/posts" title="+AndrocodeEs" target="_blank">
            <i class="icon fa fa-google-plus-square"></i>
            <span class="label">Google+</span>
          </a>
        </li>

        <li class="social-item github">
          <a href="http://github.com/androcode-es" title="@androcode-es on GitHub" target="_blank">
            <i class="icon fa fa-github"></i>
            <span class="label">GitHub</span>
          </a>
        </li>
      </ul>
    </nav>

    <p class="sidebar-foot-note">&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      
<div class="post">
  <h1 class="post-title">Trabajando con Parcelables</h1>
  <a class="author" href="http://www.forgottenprojects.com/" target="_blank">
    <img class="author-avatar" src="http://1.gravatar.com/avatar/d929099dfdb6b0abc8b051ae8c9ae5ec?s=35&d=&r=G"/>
    <span class="post-date author-name">Fernando F. Gallego, 17 Dec 2012</span>
  </a>
  <p>Hola a todos! hoy me estreno en androcode.es con un artículo sobre tipos parcelables, si no sabes lo que son, hoy aprenderás para qué sirven y cómo implementarlos.
<a href="http://androcode.es/wp-content/uploads/2015/02/decibels_zesjsx.png"><img src="http://androcode.es/wp-content/uploads/2015/02/decibels_zesjsx-300x201.png" alt="" title="teach"></a></p>

<!--more-->

<p>Normalmente cuando queremos pasar un objeto entre actividades tenemos varias opciones, unas más elegantes y otras menos.</p>

<p>Tal vez lo primero que se nos ocurra sea guardar el objeto en un campo static de una de nuestras clases, y recuperarlo en la nueva actividad, pero este tipo de prácticas no están muy bien vistas ya que puedes incurrir en problemas de concurrencia, leaks de memoria, etc.</p>

<p>Puede que lo siguiente que se te ocurra sea implementar en el objeto la interfaz serializable. Esta solución no es mala para objetos pequeños pero en la práctica es muy lenta y si vamos a serializar un objeto complejo y grande, no es la mejor solución. Por eso el equipo de android decidió inventarse los tipos parcelables, que en la práctica es como escribir los tipos en un <a href="http://developer.android.com/reference/android/os/Bundle.html">Bundle</a> y recuperarlos después. De echo el objeto Bundle implementa la interfaz Parcelable y cuando haces intent.putExtra(&quot;key&quot;,&quot;hello world&quot;), estás escribiendo un Bundle asociado al intent, y cuando haces getIntent().getExtras() para leer, es un Bundle de donde lees.</p>

<p>Pero vamos a ver esto con más detalle y vamos a ver como podemos implementar la interfaz <a href="http://developer.android.com/reference/android/os/Parcelable.html">Parcelable</a> en nuestros objetos para pasarlos entre actividades o servicios de una manera rápida.  </p>

<p>Puedes descargarte el <a href="https://github.com/ferdy182/Android-parcelable-example" title="ferdy182 en GitHub Android parcelable example">código de ejemplo de github</a> Lo primero es crearnos una clase que implemente la interfaz <a href="http://developer.android.com/reference/android/os/Parcelable.html">Parcelable</a>
```
package com.example.parcelable;</p>

<p>import android.os.Parcel;
import android.os.Parcelable;</p>

<p>public class Estudiante implements Parcelable {</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@Override
public int describeContents() {
    return 0;
}

@Override
public void writeToParcel(Parcel dest, int flags) {

}
</code></pre></div>
<p>}
```</p>

<p>Esto nos creará un par de métodos en la clase, describeContents, que en los ejemplos siempre ponen return 0; así que de momento no nos preocupamos, y el método writeToParcel que recibe un objeto Parcel de destino y un flag que puede ser 0 o <a href="http://developer.android.com/reference/android/os/Parcelable.html#PARCELABLE_WRITE_RETURN_VALUE"><em>PARCELABLE<em>WRITE</em>RETURN_VALUE</em></a>.</p>

<p>Yo recomiendo añadir otro constructor al objeto que reciba un Parcel para recrearlo a partir de ahí y un método readFromParcel(Parcel in) para rellenar los campos del objeto y tenerlo más ordenado.</p>

<p>Además vamos a añadirle unos campos a la clase, porque una clase sin campos no vale para mucho ¿no?</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">package com.example.parcelable;

import java.util.List;

import android.os.Parcel;
import android.os.Parcelable;

public class Estudiante implements Parcelable {
    int fechaNacimiento;
    String nombreCompleto;
    boolean esHijoUnico;
    float[] notas;
    List&amp;lt;Estudiante&amp;gt; amigos;

    public Estudiante() {
        notas = new float[3];
        amigos = new ArrayList&amp;lt;Estudiante&amp;gt;();
    }

    public Estudiante(Parcel in) {
        notas = new float[3];
        amigos = new ArrayList&amp;lt;Estudiante&amp;gt;();
        readFromParcel(in);
    }

    @Override
    public int describeContents() {
        return 0;
    }

    @Override
    public void writeToParcel(Parcel dest, int flags) {

    }

    private void readFromParcel(Parcel in) {

    }

}
</code></pre></div>
<p>Cómo veis, he añadido unos campos de distintos tipos, incluidos un array de floats y una lista tipada (para que veáis que se pueden meter distintos tipos en un Parcel).</p>

<p>Ahora vamos a ver la chicha, cómo guardar el objeto en un Parcel y como recuperarlo después.</p>

<p>Básicamente el objeto Parcel nos expone unos métodos para escribir nuestros campos según su tipo para no equivocarnos, por lo que rellenamos nuestro método writeToParcel de la forma siguiente:
<code>
@Override
public void writeToParcel(Parcel dest, int flags) {
    dest.writeInt(fechaNacimiento);
    dest.writeString(nombreCompleto);
    dest.writeBooleanArray(new boolean[]{esHijoUnico});
    dest.writeFloatArray(notas);
    dest.writeTypedList(amigos);
}
</code>
Mientras escribía esto he descubierto que <a href="http://code.google.com/p/android/issues/detail?id=5973">no hay un método Parcel.writeBoolean(boolean val)</a> (gracias Google!) por lo que podéis o bien escribirlo en un array de booleans con un único valor, o escribir un byte y luego parsearlo como boolean.</p>

<p>Ahora vamos a ver como recuperaríamos nuestro objeto de un Parcel, así que rellenamos el método readFromParcel de esta manera:
```
private void readFromParcel(Parcel in) {
    fechaNacimiento = in.readInt();
    nombreCompleto = in.readString();</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">boolean[] temp = new boolean[1];
in.readBooleanArray(temp);
esHijoUnico = temp[0];

in.readFloatArray(notas);
in.readTypedList(amigos, CREATOR);
</code></pre></div>
<p>}
<code>
¡Ostras! Para leer una lista tipada necesito un objeto Parcelable.Creator, ¿qué es eso? Digamos que es un objeto que genera objetos del tipo que le digas a partir de un Parcel (vamos, lo que veníamos haciendo) pero es necesario para recrear los objetos en otros Parcelables. Es muy sencillo, sólo hay que añadir esto:
</code>
public static final Parcelable.Creator&lt;Estudiante&gt; CREATOR
    = new Parcelable.Creator&lt;Estudiante&gt;() {
        public Estudiante createFromParcel(Parcel in) {
            return new Estudiante(in);
        }</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    public Estudiante[] newArray(int size) {
        return new Estudiante[size];
    }
};
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">Ahora veis como añadir un constructor que recibe un Parcel era buena idea para tener todo limpito. Además, nota importante, cuando leemos del Parcel no hay pares clave-valor, así que hay que **leerlo en el mismo orden en que lo escribimos**.

¡Pues ya tenemos nuestro objeto implementado! Vamos a ver si funciona. Creamos un par de activities, en el primero creamos un par de estudiantes, uno amigo del otro (¡no es un amistad mutua así que sin referencias cruzadas por favor!) y lo metemos en los extras de un intent que viajarán a la segunda activity donde rescatamos nuestro estudiante y escribimos en el LogCat toda la info que hemos recibido de él y de su amigo no correspondido:

**MainActivity.java**
</code></pre></div>
<p>Estudiante otroEstudiante = new Estudiante();
otroEstudiante.nombreCompleto = &quot;Perico Palotes&quot;;
otroEstudiante.esHijoUnico = false;
otroEstudiante.fechaNacimiento = 1990;
otroEstudiante.notas = new float[]{7.8f, 4.9f, 10.0f};
otroEstudiante.amigos = new ArrayList&lt;Estudiante&gt;();</p>

<p>Estudiante estudiante = new Estudiante();
estudiante.nombreCompleto = &quot;Fernando F. Gallego&quot;;
estudiante.esHijoUnico = true;
estudiante.fechaNacimiento = 1983;
estudiante.notas = new float[]{9.5f, 8.6f, 4.6f};
estudiante.amigos = new ArrayList&lt;Estudiante&gt;();</p>

<p>estudiante.amigos.add(otroEstudiante);</p>

<p>Intent intent = new Intent(this, DestActivity.class);
intent.putExtra(&quot;estudiante&quot;, estudiante);
startActivity(intent);
```</p>

<p><strong>DestActivity.java</strong>
```
Estudiante estudiante = getIntent().getParcelableExtra(&quot;estudiante&quot;);</p>

<p>Log.i(&quot;estudiante&quot;, estudiante.nombreCompleto);
Log.i(&quot;estudiante&quot;, String.valueOf(estudiante.esHijoUnico));
Log.i(&quot;estudiante&quot;, String.valueOf(estudiante.fechaNacimiento));
Log.i(&quot;estudiante&quot;, Arrays.toString(estudiante.notas));
Estudiante amigo = estudiante.amigos.get(0);
Log.i(&quot;amigo&quot;, amigo.nombreCompleto);
Log.i(&quot;amigo&quot;, String.valueOf(amigo.esHijoUnico));
Log.i(&quot;amigo&quot;, String.valueOf(amigo.fechaNacimiento));
Log.i(&quot;amigo&quot;, Arrays.toString(amigo.notas));</pre> Y esto es lo que veremos en nuestro querido LogCat <pre class="brush: bash;">I/estudiante(6739): Fernando F. Gallego
I/estudiante(6739): true
I/estudiante(6739): 1983
I/estudiante(6739): [9.5, 8.6, 4.6]
I/amigo(6739): Perico Palotes
I/amigo(6739): false
I/amigo(6739): 1990
I/amigo(6739): [7.8, 4.9, 10.0]
```</p>

<p>Puedes descargarte el <a href="https://github.com/ferdy182/Android-parcelable-example" title="ferdy182 en GitHub Android parcelable example">código de ejemplo de github</a></p>

</div>

<div class="related">
  <h2>Entradas relacionadas</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/02/03/un-stack-productivo-para-el-desarrollador-android-1-arquitectura/">
            Un ‘stack’ productivo para el desarrollador android #1, Arquitectura
            <small>03 Feb 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/11/29/entendiendo-material-design/">
            Entendiendo Material Design
            <small>29 Nov 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/10/09/un-vistazo-rapido-al-nuevo-recyclerview/">
            Un vistazo rápido al nuevo RecyclerView
            <small>09 Oct 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
